function VariantSelector(index,element){this.$element=$(element),this.index=index,this.selectors={masterIdInput:"input[name='id']",variantOptions:".product__variant-option",optionsContainer:".product__radio",subPurchaseClass:".subscription-purchase",oneTimePurchaseClass:".one-time-purchase",subGroupPrice:".sub-group__price",formContainer:".product__form",selectedSubGroup:".sub-group.is-selected",quantityCount:".quantity-picker__input",buttonPrice:".featured-product-card__price",variantWeight:$("input[name='properties[_custom_weights]']")},this.initialize()}VariantSelector.prototype=Object.assign({},VariantSelector.prototype,{initialize:function(){this.$masterIdInput=$(this.selectors.masterIdInput),this.$variantOptions=this.$element.find(this.selectors.variantOptions),this.$quantityCount=$(this.selectors.quantityCount),this.$buttonPrice=$(this.selectors.buttonPrice),this.$variantOptions.on("change",this._handleVariantChange.bind(this))},_handleVariantChange:function(event){this._setVariantID(event),this._setPrice(event)},_setVariantID:function(event){this.$masterIdInput.val(Number($(event.currentTarget).data("id")))},_setPrice:function(event){let currentPrice=$(event.currentTarget).data("price");this.$buttonPrice.text(currentPrice)}}),$(".product__variant-wrapper").each(function(index,element){const variantSelector=new VariantSelector(index,element)});function ProductSubscription(index,element){this.$element=$(element),this.index=index,this.selectors={purchaseOptions:"input[ name='purchase_option' ]",sellingPlans:"input[ name='selling_plan' ]",subGroup:".sub-group",selectedSubGroup:".sub-group.is-selected",formContainer:".product__form",buttonPrice:".featured-product-card__price",packQty:'input[name="quantity"]',packPrice:".pack-price",sellingPlanOption:".sub-group__option"},this.initialize()}ProductSubscription.prototype=Object.assign({},ProductSubscription.prototype,{initialize:function(){this.$purchaseOptions=this.$element.find(this.selectors.purchaseOptions),this.$sellingPlans=this.$element.find(this.selectors.sellingPlans),this.$subGroup=this.$element.find(this.selectors.subGroup),this.$selectedSubGroup=this.$element.find(this.selectors.selectedSubGroup),this.$element.closest(this.selectors.formContainer).find("form").data("selected-price",this.$element.find(this.selectors.selectedSubGroup).data("price")),this.$element.closest(this.selectors.formContainer).find(this.selectors.buttonPrice).text("$"+this.$selectedSubGroup.data("price")),this.$element.closest(this.selectors.formContainer).find(this.selectors.packPrice).text("$"+this.$selectedSubGroup.data("price")),this.updateOneTimeDiscounts(!this.$selectedSubGroup.find(this.selectors.purchaseOptions).val()),this.$purchaseOptions.on("change",this._handlePurchaseOptionsChange.bind(this)),this.$sellingPlans.on("change",this._handleSellingPlanChange.bind(this))},_handlePurchaseOptionsChange:function(event){const isOneTime=!event.target.value,basePrice=$(event.target).closest(this.selectors.subGroup).data("price"),currentQuantity=this.$element.closest(this.selectors.formContainer).find("form").data("current-quantity");let currentPackQty=Number(this.$element.parents(this.selectors.formContainer).find(this.selectors.packQty).val());const newPrice=basePrice*currentPackQty,singleNewPrice=basePrice*1;this.$subGroup.toggleClass("is-selected"),this.$sellingPlans.prop("disabled",isOneTime),this.$element.closest(this.selectors.formContainer).find("form").data("selected-price",basePrice),this.$element.closest(this.selectors.formContainer).find(this.selectors.buttonPrice).text("$"+newPrice.toFixed(2)),this.$element.closest(this.selectors.formContainer).find(this.selectors.packPrice).text("$"+singleNewPrice.toFixed(2)),this.updateOneTimeDiscounts(isOneTime)},_handleSellingPlanChange:function(event){const basePrice=$(event.currentTarget).closest(this.selectors.sellingPlanOption).data("price");let currentPackQty=Number(this.$element.parents(this.selectors.formContainer).find(this.selectors.packQty).val());const newPrice=basePrice*currentPackQty,singleNewPrice=basePrice*1;$(event.currentTarget).closest(this.selectors.subGroup).data("price",basePrice),this.$element.closest(this.selectors.formContainer).find("form").data("selected-price",basePrice),this.$element.closest(this.selectors.formContainer).find(this.selectors.buttonPrice).text("$"+newPrice.toFixed(2)),this.$element.closest(this.selectors.formContainer).find(this.selectors.packPrice).text("$"+singleNewPrice.toFixed(2))},updateOneTimeDiscounts:function(isOneTime){if($(".one-time-discount-label").toggleClass("hidden",!isOneTime),isOneTime){const $buttonPrice=$(".featured-product-card__price"),oldButtonPrice=$buttonPrice.text().replace("$",""),selectedDiscount=$('[name="product-pack-quantity"]:checked').closest("li").data("discount"),newButtonPrice=oldButtonPrice-oldButtonPrice*selectedDiscount;$buttonPrice.text(`$${newButtonPrice.toFixed(2)}`),$(".product-top__content-quantity ul li").each((i,e)=>{const packPriceElement=$(e).find(".pack-price"),oldOneTimePrice=packPriceElement.text().replace("$",""),newOneTimePrice=oldOneTimePrice-oldOneTimePrice*$(e).data("discount");packPriceElement.text(`$${newOneTimePrice.toFixed(2)}`)})}}}),$(".subscription").each(function(index,element){const subscription=new ProductSubscription(index,element)});function QuantitySelector(index,element){this.$element=$(element),this.index=index,this.selectors={input:".quantity-selector__input",plus:".quantity-selector__plus",minus:".quantity-selector__minus",count:".quantity-selector__count",unit:".quantity-selector__unit",formContainer:".product__form",buttonPrice:".price-item"},this.initialize()}QuantitySelector.prototype=Object.assign({},QuantitySelector.prototype,{initialize:function(){const min=this.$element.data("min");this.min=min!=""?parseInt(min):1,this.$input=this.$element.find(this.selectors.input),this.$plus=this.$element.find(this.selectors.plus),this.$minus=this.$element.find(this.selectors.minus),this.$count=this.$element.find(this.selectors.count),this.$unit=this.$element.find(this.selectors.unit),this.$element.closest(this.selectors.formContainer).find("form").data("current-quantity",1),this.$plus.on("click",this._handlePlus.bind(this)),this.$minus.on("click",this._handleMinus.bind(this))},_updateQuantifier:function(value){const singular=this.$unit.data("single"),plural=this.$unit.data("plural");let quantifier=singular||this.$unit.text(),pluralText=plural||`${singular}s`;value>1&&(quantifier=pluralText),this.$unit.text(quantifier)},_updateQuantity:function(value){this.$input.val(value),this.$count.text(value),this._updateQuantifier(value),this._updatePrice(value)},_updatePrice:function(value){const newPrice=this.$element.closest(this.selectors.formContainer).find("form").data("selected-price")*value;this.$element.closest(this.selectors.formContainer).find("form").data("current-quantity",value),this.$element.closest(this.selectors.formContainer).find(this.selectors.buttonPrice).text("$"+newPrice.toFixed(2))},_handlePlus:function(event){const currentCount=parseInt(this.$input.val());this._updateQuantity(currentCount+1)},_handleMinus:function(event){const currentCount=parseInt(this.$input.val());currentCount>this.min&&this._updateQuantity(currentCount-1)}}),$(".quantity-selector").each(function(index,element){const quantitySelector=new QuantitySelector(index,element)});class ProductForm extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cartNotification=document.querySelector("cart-notification")}onSubmitHandler(evt){evt.preventDefault(),this.cartNotification.setActiveElement(document.activeElement);const submitButton=this.querySelector('[type="submit"]');submitButton.setAttribute("disabled",!0),submitButton.classList.add("loading");const body=JSON.stringify({...JSON.parse(serializeForm(this.form)),sections:this.cartNotification.getSectionsToRender().map(section=>section.id),sections_url:window.location.pathname});fetch(`${routes.cart_add_url}`,{...fetchConfig("javascript"),body}).then(response=>response.json()).then(parsedState=>{this.cartNotification.renderContents(parsedState)}).catch(e=>{console.error(e)}).finally(()=>{submitButton.classList.remove("loading"),submitButton.removeAttribute("disabled")})}}customElements.define("product-form",ProductForm);
//# sourceMappingURL=/cdn/shop/t/2/assets/product-form.js.map?v=157554519459486018431718715696
